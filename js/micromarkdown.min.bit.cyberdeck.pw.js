/*
 * Âµmarkdown.js
 * markdown in under 5kb
 *
 * Copyright 2014, Simon Waldherr - http://simon.waldherr.eu/
 *                 Mauro - http://bit.cyberdeck.pw/
 * Released under the MIT Licence
 * http://simon.waldherr.eu/license/mit/
 *
 * Github:  https://github.com/simonwaldherr/micromarkdown.js/
 * Github:  https://github.com/lvm/lvm.github.io/
 * Version: 0.2.0~bit.cyberdeck.pw
 */
var micromarkdown={useajax:false,regexobject:{headline:/^(\#{1,6})([^\#\n]+)$/m,code:/\s\`\`\`\n?([^`]+)\`\`\`/g,hr:/^(?:([\*\-_] ?)+)\1\1$/gm,lists:/^((\s*((\*|\-)|\d(\.|\))) [^\n]+)\n)+/gm,bolditalic:/(?:([\*_~]{1,3}))([^\*_~\n]+[^\*_~\s])\1/g,links:/!?\[([^\]<>]+)\]\(([^ \)<>]+)( "[^\(\)\"]+")?\)/g,reflinks:/\[([^\]]+)\]\[([^\]]+)\]/g,smlinks:/\@([a-z0-9]{3,})\@(t|gh|fb|gp|adn)/gi,mail:/<(([a-z0-9_\-\.])+\@([a-z0-9_\-\.])+\.([a-z]{2,7}))>/gmi,tables:/\n(([^|\n]+ *\| *)+([^|\n]+\n))((:?\-+:?\|)+(:?\-+:?)*\n)((([^|\n]+ *\| *)+([^|\n]+)\n)+)/g,include:/[\[<]include (\S+) from (https?:\/\/[a-z0-9\.\-]+\.[a-z]{2,9}[a-z0-9\.\-\?\&\/]+)[\]>]/gi,url:/<([a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[\-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?)>/g},parse:function(e,t){"use strict";var n,r=0,i,s,o,u,a,f,l,c,h,p,d=[],v=0,m=0,g=0;e="\n"+e+"\n";if(t!==true){micromarkdown.regexobject.lists=/^((\s*(\*|\d\.) [^\n]+)\n)+/gm}while((p=micromarkdown.regexobject.code.exec(e))!==null){e=e.replace(p[0],"<code>\n"+micromarkdown.htmlEncode(p[1]).replace(/\n/gm,"<br/>").replace(/\ /gm,"&nbsp;")+"</code>\n")}while((p=micromarkdown.regexobject.headline.exec(e))!==null){c=p[1].length;e=e.replace(p[0],"<h"+c+">"+p[2]+"</h"+c+">"+"\n")}while((p=micromarkdown.regexobject.lists.exec(e))!==null){v=0;if(p[0].trim().substr(0,1)==="*"||p[0].trim().substr(0,1)==="-"){h="<ul>"}else{h="<ol>"}a=p[0].split("\n");f=[];i=0;u=false;for(m=0;m<a.length;m++){if((n=/^((\s*)((\*|\-)|\d(\.|\))) ([^\n]+))/.exec(a[m]))!==null){if(n[2]===undefined||n[2].length===0){r=0}else{if(u===false){u=n[2].replace(/\t/,"    ").length}r=Math.round(n[2].replace(/\t/,"    ").length/u)}while(i>r){h+=f.pop();i--;v--}while(i<r){if(n[0].trim().substr(0,1)==="*"||n[0].trim().substr(0,1)==="-"){h+="<ul>";f.push("</ul>")}else{h+="<ol>";f.push("</ol>")}i++;v++}h+="<li>"+n[6]+"</li>"+"\n"}}while(v>0){h+="</ul>";v--}if(p[0].trim().substr(0,1)==="*"||p[0].trim().substr(0,1)==="-"){h+="</ul>"}else{h+="</ol>"}e=e.replace(p[0],h+"\n")}while((p=micromarkdown.regexobject.tables.exec(e))!==null){h="<table><tr>";a=p[1].split("|");o=p[4].split("|");for(m=0;m<a.length;m++){if(o.length<=m){o.push(0)}else if(o[m].trimRight().slice(-1)===":"&&t!==true){if(o[m][0]===":"){o[m]=3}else{o[m]=2}}else if(t!==true){if(o[m][0]===":"){o[m]=1}else{o[m]=0}}else{o[m]=0}}s=["<th>",'<th align="left">','<th align="right">','<th align="center">'];for(m=0;m<a.length;m++){h+=s[o[m]]+a[m].trim()+"</th>"}h+="</tr>";s=["<td>",'<td align="left">','<td align="right">','<td align="center">'];f=p[7].split("\n");for(m=0;m<f.length;m++){l=f[m].split("|");if(l[0].length!==0){while(o.length<l.length){o.push(0)}h+="<tr>";for(g=0;g<l.length;g++){h+=s[o[g]]+l[g].trim()+"</td>"}h+="</tr>"+"\n"}}h+="</table>";e=e.replace(p[0],h)}for(m=0;m<3;m++){while((p=micromarkdown.regexobject.bolditalic.exec(e))!==null){h=[];if(p[1]==="~~"){e=e.replace(p[0],"<del>"+p[2]+"</del>")}else{switch(p[1].length){case 1:h=["<i>","</i>"];break;case 2:h=["<b>","</b>"];break;case 3:h=["<i><b>","</b></i>"];break}e=e.replace(p[0],h[0]+p[2]+h[1])}}}while((p=micromarkdown.regexobject.links.exec(e))!==null){if(p[0].substr(0,1)==="!"){e=e.replace(p[0],'<img src="'+p[2]+'" alt="'+p[1]+'" title="'+p[1]+'" />\n')}else{e=e.replace(p[0],"<a "+micromarkdown.mmdCSSclass(p[2],t)+'href="'+p[2]+'">'+p[1]+"</a>\n")}}while((p=micromarkdown.regexobject.mail.exec(e))!==null){e=e.replace(p[0],'<a href="mailto:'+p[1]+'">'+p[1]+"</a>")}while((p=micromarkdown.regexobject.url.exec(e))!==null){h=p[1];if(h.indexOf("://")===-1){h="http://"+h}e=e.replace(p[0],"<a "+micromarkdown.mmdCSSclass(h,t)+'href="'+h+'">'+h.replace(/(https:\/\/|http:\/\/|mailto:|ftp:\/\/)/gmi,"")+"</a>")}while((p=micromarkdown.regexobject.reflinks.exec(e))!==null){f=new RegExp("\\["+p[2]+"\\]: ?([^ \n]+)","gi");if((a=f.exec(e))!==null){e=e.replace(p[0],"<a "+micromarkdown.mmdCSSclass(a[1],t)+'href="'+a[1]+'">'+p[1]+"</a>");d.push(a[0])}}for(m=0;m<d.length;m++){e=e.replace(d[m],"")}while((p=micromarkdown.regexobject.smlinks.exec(e))!==null){switch(p[2]){case"t":h="https://twitter.com/"+p[1];break;case"gh":h="https://github.com/"+p[1];break;case"fb":h="https://www.facebook.com/"+p[1];break;case"gp":h="https://plus.google.com/+"+p[1];break;case"adn":h="https://alpha.app.net/"+p[1];break}e=e.replace(p[0],"<a "+micromarkdown.mmdCSSclass(h,t)+'href="'+h+'">'+p[1]+"</a>")}while((p=micromarkdown.regexobject.hr.exec(e))!==null){e=e.replace(p[0],"\n<hr/>\n")}if(micromarkdown.useajax!==false&&t!==true){while((p=micromarkdown.regexobject.include.exec(e))!==null){a=p[2].replace(/[\.\:\/]+/gm,"");f="";if(document.getElementById(a)){f=document.getElementById(a).innerHTML.trim()}else{micromarkdown.ajax(p[2])}if(p[1]==="csv"&&f!==""){l={";":[],"	":[],",":[],"|":[]};l[0]=[";","	",",","|"];f=f.split("\n");for(g=0;g<l[0].length;g++){for(m=0;m<f.length;m++){if(m>0){if(l[l[0][g]]!==false){if(l[l[0][g]][m]!==l[l[0][g]][m-1]||l[l[0][g]][m]===1){l[l[0][g]]=false}}}}}if(l[";"]!==false||l["	"]!==false||l[","]!==false||l["|"]!==false){if(l[";"]!==false){l=";"}else if(l["	"]){l="	"}else if(l[","]){l=","}else if(l["|"]){l="|"}h="<table>";for(m=0;m<f.length;m++){a=f[m].split(l);h+="<tr>";for(g=0;g<a.length;g++){h+="<td>"+micromarkdown.htmlEncode(a[g])+"</td>"}h+="</tr>"}h+="</table>";e=e.replace(p[0],h)}else{e=e.replace(p[0],"<code>"+f.join("\n")+"</code>")}}else{e=e.replace(p[0],"")}}}e=e.replace(/ {2,}[\n]{1,}/gmi,"<br/>");return e},ajax:function(e){"use strict";var t;if(document.getElementById(e.replace(/[\.\:\/]+/gm,""))){return false}if(window.ActiveXObject){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){t=null;return n}}else{t=new XMLHttpRequest}t.onreadystatechange=function(){if(t.readyState===4){var n=document.createElement("code");n.innerHTML=t.responseText;n.id=e.replace(/[\.\:\/]+/gm,"");n.style.display="none";document.getElementsByTagName("body")[0].appendChild(n);micromarkdown.useajax()}};t.open("GET",e,true);t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.send()},countingChars:function(e,t){"use strict";e=e.split(t);if(typeof e==="object"){return e.length-1}return 0},htmlEncode:function(e){"use strict";var t=document.createElement("div");t.appendChild(document.createTextNode(e));e=t.innerHTML;t=undefined;return e},mmdCSSclass:function(e,t){"use strict";if(e.indexOf("/")!==-1&&t!==true){return'class="mmd_'+e.replace(/[^\w\d]/g,"")+'" '}return""}}
